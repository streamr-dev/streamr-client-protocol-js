<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>streamr-client-protocol - v8.0.5</title>
	<meta name="description" content="Documentation for streamr-client-protocol - v8.0.5">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">streamr-client-protocol - v8.0.5</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>streamr-client-protocol - v8.0.5</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#streamr-client-protocol" id="streamr-client-protocol" style="color: inherit; text-decoration: none;">
					<h1>streamr-client-protocol</h1>
				</a>
				<p>ES6 JS implementations of <a href="https://github.com/streamr-dev/streamr-specs/blob/master/PROTOCOL.md">Streamr Protocol</a> messages. This is shared code used by (at least):</p>
				<ul>
					<li><a href="https://github.com/streamr-dev/streamr-client-javascript">streamr-client-javascript</a></li>
					<li><a href="https://github.com/streamr-dev/streamr-broker">streamr-broker</a></li>
					<li><a href="https://github.com/streamr-dev/streamr-network">streamr-network</a></li>
				</ul>
				<p>Please see the <a href="https://streamr-dev.github.io/streamr-client-protocol/">API Docs</a> for more detailed documentation.</p>
				<p> The package is available on npm as <code>streamr-client-protocol</code>.</p>
				<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
					<h2>Table of Contents</h2>
				</a>
				<ul>
					<li><a href="#use">Use</a></li>
					<li><a href="#release">Release</a></li>
				</ul>
				<a href="#use" id="use" style="color: inherit; text-decoration: none;">
					<h2>Use</h2>
				</a>
				<a href="#creating-messages-from-arguments" id="creating-messages-from-arguments" style="color: inherit; text-decoration: none;">
					<h4>Creating messages from arguments</h4>
				</a>
				<p>Every message type from both the Control Layer and the Message Layer is defined as a class and has a static <code>create</code> method that takes class-specific arguments to build an instance of the latest version of the message type. The arguments for each message type are defined in the <a href="https://github.com/streamr-dev/streamr-specs/blob/master/PROTOCOL.md">protocol documentation</a> and in the definition of the <code>create</code> method.</p>
				<p>This example shows how to create a <code>StreamMessage</code> and encapsulate it in a <code>PublishRequest</code>.</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">streamMessage</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">StreamMessage</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">messageId:</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">MessageID</span><span style="color: #000000">(...),</span>
<span style="color: #000000">    </span><span style="color: #001080">content</span>
<span style="color: #000000">})</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">publishRequest</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">PublishRequest</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">requestId:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;requestId&#039;</span><span style="color: #000000">, </span>
<span style="color: #000000">    </span><span style="color: #001080">streamMessage</span><span style="color: #000000">, </span>
<span style="color: #000000">})</span>
</code></pre>
				<a href="#serializing-messages-to-strings" id="serializing-messages-to-strings" style="color: inherit; text-decoration: none;">
					<h4>Serializing messages to strings</h4>
				</a>
				<p>Every message type from both the Control Layer and the Message Layer has a <code>serialize</code> method, which takes as argument the version to serialize to. By default, it serializes to the latest version of the message type. The <code>serialize</code> methods return a string.</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">streamMessage</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">StreamMessage</span><span style="color: #000000">({...})</span>
<span style="color: #001080">streamMessage</span><span style="color: #000000">.</span><span style="color: #795E26">serialize</span><span style="color: #000000">() </span><span style="color: #008000">// to latest version</span>
<span style="color: #008000">// &gt; &#039;[31,[&quot;streamId&quot;,0,1529549961116,&quot;publisherId&quot;,&quot;msgChainId&quot;],null,27,0,{&quot;foo&quot;:&quot;bar&quot;},0,null]&#039;</span>
<span style="color: #001080">streamMessage</span><span style="color: #000000">.</span><span style="color: #795E26">serialize</span><span style="color: #000000">(</span><span style="color: #098658">30</span><span style="color: #000000">) </span><span style="color: #008000">// to MessageLayer version 30</span>
<span style="color: #008000">// &gt; &#039;[30,[&quot;streamId&quot;,0,1529549961116,&quot;publisherId&quot;,&quot;msgChainId&quot;],null,27,{&quot;foo&quot;:&quot;bar&quot;},0,null]&#039;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">subscribeRequest</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">SubscribeRequest</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">streamId:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;streamId&#039;</span><span style="color: #000000">, </span>
<span style="color: #000000">    </span><span style="color: #001080">streamPartition:</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000">, </span>
<span style="color: #000000">    </span><span style="color: #001080">sessionToken:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;sessionToken&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">})</span>
<span style="color: #001080">subscribeRequest</span><span style="color: #000000">.</span><span style="color: #795E26">serialize</span><span style="color: #000000">() </span><span style="color: #008000">// to latest version</span>
<span style="color: #008000">// &gt; &#039;[2,9,&quot;requestId&quot;,&quot;streamId&quot;,0,&quot;sessionToken&quot;]&#039;</span>
<span style="color: #001080">subscribeRequest</span><span style="color: #000000">.</span><span style="color: #795E26">serialize</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #008000">// to ControlLayer version 1</span>
<span style="color: #008000">// &gt; &#039;[1,9,&quot;streamId&quot;,0,&quot;sessionToken&quot;]&#039;</span>
</code></pre>
				<a href="#parsing-messages-from-strings" id="parsing-messages-from-strings" style="color: inherit; text-decoration: none;">
					<h4>Parsing messages from strings</h4>
				</a>
				<p>For deserialization, use the static <code>deserialize</code> method that is present in <code>ControlMessage</code> for the ControlLayer and <code>StreamMessage</code> for the Message Layer. The <code>deserialize</code> method accepts both strings and arrays as input.</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">serializedStreamMessage</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;[30,[&quot;streamId&quot;,0,1529549961116,&quot;publisherId&quot;,&quot;msgChainId&quot;],null,27,{&quot;foo&quot;:&quot;bar&quot;},0,null]&#039;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">streamMessage</span><span style="color: #000000"> = </span><span style="color: #001080">StreamMessage</span><span style="color: #000000">.</span><span style="color: #795E26">deserialize</span><span style="color: #000000">(</span><span style="color: #001080">serializedStreamMessage</span><span style="color: #000000">)</span>
</code></pre>
				<p>On the other hand, the Control Layer has many different message types. So we can only know that the <code>deserialize</code> method will return a <code>ControlMessage</code>. We can use the <code>type</code> field to differentiate.</p>
				<pre><code class="language-javascript"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">serializedMessage</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;[1,9,&quot;streamId&quot;,0,&quot;sessionToken&quot;]&#039;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">controlMessage</span><span style="color: #000000"> = </span><span style="color: #001080">ControlMessage</span><span style="color: #000000">.</span><span style="color: #795E26">deserialize</span><span style="color: #000000">(</span><span style="color: #001080">serializedMessage</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">controlMessage</span><span style="color: #000000">.</span><span style="color: #001080">type</span><span style="color: #000000"> === </span><span style="color: #001080">ControlMessage</span><span style="color: #000000">.</span><span style="color: #0070C1">TYPES</span><span style="color: #000000">.</span><span style="color: #001080">UnicastMessage</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #008000">//treat it as a UnicastMessage</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">else</span><span style="color: #000000"> </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">controlMessage</span><span style="color: #000000">.</span><span style="color: #001080">type</span><span style="color: #000000"> === </span><span style="color: #001080">ControlMessage</span><span style="color: #000000">.</span><span style="color: #0070C1">TYPES</span><span style="color: #000000">.</span><span style="color: #001080">SubscribeRequest</span><span style="color: #000000">) {</span>
<span style="color: #000000">    </span><span style="color: #008000">//treat it as a SubscribeRequest</span>
<span style="color: #000000">} </span><span style="color: #AF00DB">else</span><span style="color: #000000"> </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (...) {</span>
<span style="color: #000000">    </span>
<span style="color: #000000">} </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Error</span><span style="color: #000000">(</span><span style="color: #A31515">`Unknown type: </span><span style="color: #0000FF">${</span><span style="color: #001080">controlMessage</span><span style="color: #000000FF">.</span><span style="color: #001080">type</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">)</span>
<span style="color: #000000">}</span>
</code></pre>
				<a href="#release" id="release" style="color: inherit; text-decoration: none;">
					<h2>Release</h2>
				</a>
				<p>Publishing to NPM is automated via Github Actions. Follow the steps below to publish stable (<code>latest</code>) or <code>beta</code>.</p>
				<a href="#publishing-stable-latest" id="publishing-stable-latest" style="color: inherit; text-decoration: none;">
					<h3>Publishing stable (latest)</h3>
				</a>
				<ol>
					<li><code>git checkout master &amp;&amp; git pull</code></li>
					<li>Update version with either <code>npm version [patch|minor|major]</code>. Use semantic versioning
					<a href="https://semver.org/">https://semver.org/</a>. Files package.json and package-lock.json will be automatically updated, and an appropriate git commit and tag created. </li>
					<li><code>git push --follow-tags</code></li>
					<li>Wait for Github Actions to run tests</li>
					<li>If tests passed, Github Actions will publish the new version to NPM</li>
				</ol>
				<a href="#publishing-beta" id="publishing-beta" style="color: inherit; text-decoration: none;">
					<h3>Publishing beta</h3>
				</a>
				<ol>
					<li>Update version with either <code>npm version [prepatch|preminor|premajor] --preid=beta</code>. Use semantic versioning
					<a href="https://semver.org/">https://semver.org/</a>. Files package.json and package-lock.json will be automatically updated, and an appropriate git commit and tag created. </li>
					<li><code>git push --follow-tags</code></li>
					<li>Wait for Github Actions to run tests</li>
					<li>If tests passed, Github Actions will publish the new version to NPM</li>
				</ol>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/controllayer.html">Control<wbr>Layer</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/errors.html">Errors</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/messagelayer.html">Message<wbr>Layer</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/trackerlayer.html">Tracker<wbr>Layer</a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/utils.html">Utils</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-reference">
						<a href="modules.html#broadcastmessage" class="tsd-kind-icon">Broadcast<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#cachingstreammessagevalidator" class="tsd-kind-icon">Caching<wbr>Stream<wbr>Message<wbr>Validator</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#controlmessage" class="tsd-kind-icon">Control<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#controlmessagetype" class="tsd-kind-icon">Control<wbr>Message<wbr>Type</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#encryptedgroupkey" class="tsd-kind-icon">Encrypted<wbr>Group<wbr>Key</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#errormessage" class="tsd-kind-icon">Error<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#errorresponse" class="tsd-kind-icon">Error<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#gapfillfailederror" class="tsd-kind-icon">Gap<wbr>Fill<wbr>Failed<wbr>Error</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#groupkeyannounce" class="tsd-kind-icon">Group<wbr>Key<wbr>Announce</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#groupkeyerrorresponse" class="tsd-kind-icon">Group<wbr>Key<wbr>Error<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#groupkeymessage" class="tsd-kind-icon">Group<wbr>Key<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#groupkeyrequest" class="tsd-kind-icon">Group<wbr>Key<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#groupkeyresponse" class="tsd-kind-icon">Group<wbr>Key<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#instructionmessage" class="tsd-kind-icon">Instruction<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#invalidjsonerror" class="tsd-kind-icon">Invalid<wbr>Json<wbr>Error</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#messageid" class="tsd-kind-icon">MessageID</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#messageidstrict" class="tsd-kind-icon">MessageIDStrict</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#messageref" class="tsd-kind-icon">Message<wbr>Ref</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#messagerefstrict" class="tsd-kind-icon">Message<wbr>Ref<wbr>Strict</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#orderingutil" class="tsd-kind-icon">Ordering<wbr>Util</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#originator" class="tsd-kind-icon">Originator</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#publishrequest" class="tsd-kind-icon">Publish<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#relaymessage" class="tsd-kind-icon">Relay<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendfromrequest" class="tsd-kind-icon">Resend<wbr>From<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendlastrequest" class="tsd-kind-icon">Resend<wbr>Last<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendrangerequest" class="tsd-kind-icon">Resend<wbr>Range<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendresponsenoresend" class="tsd-kind-icon">Resend<wbr>Response<wbr>NoResend</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendresponseresending" class="tsd-kind-icon">Resend<wbr>Response<wbr>Resending</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#resendresponseresent" class="tsd-kind-icon">Resend<wbr>Response<wbr>Resent</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#signingutil" class="tsd-kind-icon">Signing<wbr>Util</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#statusmessage" class="tsd-kind-icon">Status<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#storagenodesrequest" class="tsd-kind-icon">Storage<wbr>Nodes<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#storagenodesresponse" class="tsd-kind-icon">Storage<wbr>Nodes<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#streammessage" class="tsd-kind-icon">Stream<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#streammessagetype" class="tsd-kind-icon">Stream<wbr>Message<wbr>Type</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#streammessagevalidator" class="tsd-kind-icon">Stream<wbr>Message<wbr>Validator</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#subscriberequest" class="tsd-kind-icon">Subscribe<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#subscriberesponse" class="tsd-kind-icon">Subscribe<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#timestamputil" class="tsd-kind-icon">Timestamp<wbr>Util</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#trackermessage" class="tsd-kind-icon">Tracker<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#trackermessagetype" class="tsd-kind-icon">Tracker<wbr>Message<wbr>Type</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#trackerregistry" class="tsd-kind-icon">Tracker<wbr>Registry</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#unicastmessage" class="tsd-kind-icon">Unicast<wbr>Message</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#unsubscriberequest" class="tsd-kind-icon">Unsubscribe<wbr>Request</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#unsubscriberesponse" class="tsd-kind-icon">Unsubscribe<wbr>Response</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#unsupportedversionerror" class="tsd-kind-icon">Unsupported<wbr>Version<wbr>Error</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#validationerror" class="tsd-kind-icon">Validation<wbr>Error</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#createtrackerregistry" class="tsd-kind-icon">create<wbr>Tracker<wbr>Registry</a>
					</li>
					<li class=" tsd-kind-reference">
						<a href="modules.html#gettrackerregistryfromcontract" class="tsd-kind-icon">get<wbr>Tracker<wbr>Registry<wbr>From<wbr>Contract</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>